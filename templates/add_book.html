<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Add Book - Admin Panel</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
  </head>
  <body class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1>üìö Add Book - Admin Panel</h1>
      <a href="/admin" class="btn btn-outline-secondary">‚Üê Back to Admin</a>
    </div>
    
    <div class="row">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h5>ü§ñ AI-Powered Book Selection</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="genreSelect" class="form-label">Select Genre</label>
              <select class="form-select" id="genreSelect" onchange="loadBookSuggestions(this.value)">
                <option value="">Choose a genre...</option>
              </select>
            </div>
            
            <div id="bookSuggestions" style="display: none;">
              <h6 id="selectedGenreTitle" class="mb-3"></h6>
              <div id="bookList" class="row">
                <!-- Book suggestions will be populated here -->
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h5>üìñ Selected Book Details</h5>
          </div>
          <div class="card-body">
            <form method="post" id="addBookForm">
              <div class="mb-3">
                <label for="selectedGenre" class="form-label">Genre</label>
                <input
                  type="text"
                  class="form-control"
                  id="selectedGenre"
                  name="genre"
                  readonly
                  placeholder="Select a genre first..."
                />
              </div>
              
              <div class="mb-3">
                <label for="selectedTitle" class="form-label">Title</label>
                <input
                  type="text"
                  class="form-control"
                  id="selectedTitle"
                  name="title"
                  readonly
                  placeholder="Choose a book from AI suggestions..."
                  required
                />
              </div>
              
              <div class="mb-3">
                <label for="selectedAuthor" class="form-label">Author</label>
                <input
                  type="text"
                  class="form-control"
                  id="selectedAuthor"
                  name="author"
                  readonly
                  placeholder="Choose a book from AI suggestions..."
                  required
                />
              </div>
              
              <button type="submit" class="btn btn-success" id="addBookBtn" disabled>
                ‚ûï Add Book to Library
              </button>
              <a href="/admin" class="btn btn-secondary">Cancel</a>
            </form>
          </div>
        </div>
      </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Load genres on page load
      document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/genre-suggestions')
          .then(response => response.json())
          .then(genres => {
            const genreSelect = document.getElementById('genreSelect');
            genres.forEach(genre => {
              const option = document.createElement('option');
              option.value = genre;
              option.textContent = genre;
              genreSelect.appendChild(option);
            });
          })
          .catch(error => console.error('Error loading genres:', error));
      });

      function loadBookSuggestions(genre) {
        if (!genre) {
          document.getElementById('bookSuggestions').style.display = 'none';
          clearSelectedBook();
          return;
        }

        document.getElementById('selectedGenreTitle').textContent = `${genre} Books`;
        document.getElementById('selectedGenre').value = genre;
        
        fetch(`/api/book-suggestions/${genre}`)
          .then(response => response.json())
          .then(books => {
            const bookList = document.getElementById('bookList');
            bookList.innerHTML = '';
            
            books.forEach(book => {
              const col = document.createElement('div');
              col.className = 'col-12 mb-2';
              col.innerHTML = `
                <div class="card book-suggestion border-primary" style="cursor: pointer;" onclick="selectBook('${book.title}', '${book.author}', '${genre}')">
                  <div class="card-body p-3">
                    <h6 class="card-title mb-1">${book.title}</h6>
                    <p class="card-text text-muted mb-0">by ${book.author}</p>
                  </div>
                </div>
              `;
              bookList.appendChild(col);
            });
            
            document.getElementById('bookSuggestions').style.display = 'block';
          })
          .catch(error => console.error('Error loading book suggestions:', error));
      }

      function selectBook(title, author, genre) {
        // Remove previous selections
        document.querySelectorAll('.book-suggestion').forEach(card => {
          card.classList.remove('bg-success', 'text-white');
          card.classList.add('border-primary');
        });
        
        // Highlight selected book
        event.target.closest('.book-suggestion').classList.add('bg-success', 'text-white');
        event.target.closest('.book-suggestion').classList.remove('border-primary');
        
        // Fill form fields
        document.getElementById('selectedTitle').value = title;
        document.getElementById('selectedAuthor').value = author;
        document.getElementById('selectedGenre').value = genre;
        
        // Enable add button
        document.getElementById('addBookBtn').disabled = false;
      }

      function clearSelectedBook() {
        document.getElementById('selectedTitle').value = '';
        document.getElementById('selectedAuthor').value = '';
        document.getElementById('selectedGenre').value = '';
        document.getElementById('addBookBtn').disabled = true;
      }
    </script>
  </body>
</html>
